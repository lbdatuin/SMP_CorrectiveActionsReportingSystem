@using System.Security.Claims
@inject AuthenticationStateProvider AuthStateProvider
@inject IDialogService DialogService

<MudNavMenu Rounded="true" Margin="Margin.Normal" Color="Color.Dark" Class="pl-5 pr-5 side-bar">

    <div class="user-box d-flex align-items-center">
        <div>
            <img src="images/sys/logo.png" />
        </div>
        <div class="d-flex flex-column">
            <div class="d-flex align-items-center username-cont">
                <i class="fi fi-rr-circle-user"></i>
                <h4>@username</h4>
            </div>
            <span>- @role</span>
        </div>
    </div>
    <div class="side-label">General</div>
    <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="fi fi-rr-dashboard">Dashboard</MudNavLink>

    <div class="side-label">Data Entry</div>
    <MudNavGroup Title="Creation Of CAR" Icon="fi fi-rr-poll-h">
        <MudNavLink Href="/car-form">Add Entry</MudNavLink>
        <MudNavLink Href="/corrective-action">Record Table</MudNavLink>
    </MudNavGroup>

    <div class="side-label">Settings</div>
    <MudNavGroup Title="Maintenance" Icon="fi fi-rr-settings">
        <MudNavLink Href="/users">Users</MudNavLink>
        <MudNavLink Href="/emailing-control">Emailing Control</MudNavLink>
        <MudNavLink Href="/departments">Department/Section</MudNavLink>
        <MudNavLink Href="/roles">Access Role </MudNavLink>
        <MudNavLink Href="/standard">Standard</MudNavLink>
        <MudNavLink Href="/car-type">CAR Type</MudNavLink>
        <MudNavLink Href="/non-conformity">Non-Conformity</MudNavLink>
        <MudNavLink Href="/audit-trail">Audit Trail</MudNavLink>
    </MudNavGroup>
    
</MudNavMenu>

@code {

    private string? username = string.Empty;
    private string? role = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        AuthenticationState token_auth_state = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = token_auth_state.User;
        username = user.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.UserData)?.Value;
        role = user.Claims.FirstOrDefault(claim => claim.Type == ClaimTypes.Role)?.Value;
    }

}
